{% extends 'layout/base.html' %}
{% load static %}

{% block content %}
{% comment %} <h2>회원가입</h2> {% endcomment %}

<div>
    <form id='signup-form' method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        <p>
            <label for="id_email">이메일</label><br>
            {{ form.email }}
            <button type='button' id='check-email-btn'>중복 확인</button><br>
            <span id="email-message" style="font-size:14px; color:black;"></span>
            {% comment %} {% if form.email.errors %}
                <span style="color:red;">{{ form.email.errors.0 }}</span>
            {% endif %} {% endcomment %}
        </p>

        <p>
            <label for="id_password1">비밀번호 입력</label><br>
            {{ form.password1 }}
            {% if form.password1.errors %}
                <span style="font-size:12px; color:red;">{{ form.password1.errors.0 }}</span>
            {% endif %}
            <br><span id="pw1-message" style="font-size:12px; color:black;">4~15자 사이의 영어 대/소문자, 숫자를 사용하세요.</span>
        </p>

        <p>
            <label for="id_password2">비밀번호 확인</label><br>
            {{ form.password2 }}
            {% if form.password2.errors %}
                <span style="font-size:12px; color:red;">{{ form.password2.errors.0 }}</span>
            {% endif %}
            <br><span id="pw2-message" style="font-size:14px;"></span>
        </p>

        <p>
            <label for="id_nickname">닉네임</label><br>
            {{ form.nickname }}
            {% if form.nickname.errors %}
                <span style="font-size:12px; color:red;">{{form.nickname.errors.0}}</span>
            {% endif %} 
            <br><span id="nickname-message" style="font-size:12px; color:black;">2~10자 사이의 한국어, 영어만 사용 가능합니다.</span>
        </p>


        {% comment %} {{ form.as_p }} {% endcomment %}

        <button type="submit">회원가입 완료</button>
    </form>

    <script>
    // 이메일 중복 확인
    document.getElementById('check-email-btn').addEventListener('click', async () => {
        const email = document.getElementById('id_email').value;
        const msg = document.getElementById('email-message');

        if (!email){
            msg.style.color = 'red';
            msg.textContent = '이메일을 입력하세요.';
            return;
        }

        const response = await fetch(`/uauth/check_email/?email=${email}`);
        const data = await response.json();

        if(data.exists){
            msg.style.color = 'red';
            msg.textContent = '이미 가입되어있는 이메일입니다.';
        } else{
            msg.style.color = 'blue';
            msg.textContent = '가입할 수 있는 이메일입니다.';
        }
    });

    // 비밀번호 체크
    document.getElementById('id_password1').addEventListener('input', () => {
        const pw = document.getElementById('id_password1').value;
        const msg = document.getElementById('pw1-message');
        const regex = /^[A-Za-z0-9]{4,15}$/;

        if (pw === ''){
            msg.style.color = 'black';
            msg.textContent = '4~15자 사이의 영어 대/소문자, 숫자를 사용하세요.';
        } else if (!regex.test(pw)){
            msg.style.color = 'red';
            msg.textContent = '4~15자 사이의 영어 대/소문자, 숫자를 사용하세요.';
        } else{
            msg.style.color = 'black';
            msg.textContent = '4~15자 사이의 영어 대/소문자, 숫자를 사용하세요.';
        }
    });

    // 비밀번호 확인
    document.getElementById('id_password2').addEventListener('input', () => {
        const pw1 = document.getElementById('id_password1').value;
        const pw2 = document.getElementById('id_password2').value;
        const msg = document.getElementById('pw2-message');

        if (pw2 === ''){
            msg.textContent = '';
        } else if (pw1 === pw2){
            msg.style.color = 'blue';
            msg.textContent = '비밀번호가 일치합니다.';
        } else{
            msg.style.color = 'red';
            msg.textContent = '비밀번호가 일치하지 않습니다.';
        }
    });

    // 닉네임 체크
    document.getElementById('id_nickname').addEventListener('input', () => {
        const nick = document.getElementById('id_nickname').value;
        const msg = document.getElementById('nickname-message');
        const regex = /^[A-Za-z가-힣]{2,10}$/;

        if (nick === ''){
            msg.style.color = 'black';
            msg.textContent = '2~10자 사이의 한국어, 영어만 사용 가능합니다.';
        } else if (!regex.test(nick)){
            msg.style.color = 'red';
            msg.textContent = '2~10자 사이의 한국어, 영어만 사용 가능합니다.';
        } else{
            msg.style.color = 'black';
            msg.textContent = '2~10자 사이의 한국어, 영어만 사용 가능합니다.';
        }
    });
</script>
    
</div>
{% endblock content%}